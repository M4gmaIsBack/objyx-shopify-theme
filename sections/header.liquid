<link rel="stylesheet" href="{{ 'section-header-objyx.css' | asset_url }}" media="print" onload="this.media='all'">

{%- if settings.predictive_search_enabled -%}
  <link rel="stylesheet" href="{{ 'component-price.css' | asset_url }}" media="print" onload="this.media='all'">
{%- endif -%}

<!-- TOP BAR -->
<div class="header-topbar">
  <div class="header-topbar__content">
    <ul class="header-topbar__links">
      <li>
        <a href="{{ shop.url }}/pages/contact" class="header-topbar__link">
          {{- 'header.topbar.contact' | t: default: 'Service Client' -}}
        </a>
      </li>
      <li>
        <a href="{{ shop.url }}/pages/track-order" class="header-topbar__link">
          {{- 'header.topbar.track' | t: default: 'Suivre ma commande' -}}
        </a>
      </li>
    </ul>
  </div>
</div>

<!-- MAIN HEADER -->
<header class="header-main" id="shopify-section-header">
  <div class="header-main__container">
    <!-- LOGO -->
    <div class="header-main__logo">
      {%- if request.page_type == 'index' -%}
        <h1 class="header-main__logo-heading">
      {%- endif -%}
      <a href="{{ routes.root_url }}" class="header-main__logo-link" aria-label="{{ shop.name }}">
        <img
          src="{{ 'logo_avec_name.png' | asset_url }}"
          class="header-main__logo-image"
          alt="{{ shop.name }}"
          loading="eager"
          decoding="async"
        >
      </a>
      {%- if request.page_type == 'index' -%}
        </h1>
      {%- endif -%}
    </div>

    <!-- ACTIONS (Search, Account, Cart) -->
    {%- render 'header-icons' -%}
  </div>
</header>

<!-- CATEGORIES BAR (sous le header) - Affiche automatiquement les collections -->
<nav class="header-categories" aria-label="{{ 'header.categories.label' | t: default: 'CatÃ©gories' }}">
  <div class="header-categories__container">
    <ul class="header-categories__list">
      {%- for collection in collections -%}
        {%- unless collection.handle == 'all' or collection.handle == 'frontpage' -%}
          <li class="header-categories__item">
            <a
              href="{{ collection.url }}"
              class="header-categories__link{% if collection.current %} active{% endif %}"
              {% if collection.current %}
                aria-current="page"
              {% endif %}
            >
              {{ collection.title | upcase }}
            </a>
          </li>
        {%- endunless -%}
      {%- endfor -%}
    </ul>
  </div>
</nav>

<!-- MOBILE MENU DRAWER -->
{%- render 'header-mobile-menu' -%}

{%- if settings.cart_type == 'notification' -%}
  {%- render 'cart-notification',
    color_scheme: section.settings.color_scheme,
    desktop_menu_type: section.settings.menu_type_desktop
  -%}
{%- endif -%}

{% javascript %}
  // Mobile Menu Toggle
  const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
  const mobileMenu = document.getElementById('mobile-menu');
  const mobileMenuClose = document.getElementById('mobile-menu-close');
  const mobileMenuOverlay = document.getElementById('mobile-menu-overlay');
  const mobileMenuLinks = document.querySelectorAll('.header-mobile-menu__link');

  function openMobileMenu() {
    mobileMenu.classList.add('active');
    mobileMenuOverlay.classList.add('active');
    document.body.style.overflow = 'hidden';
    mobileMenuToggle.setAttribute('aria-expanded', 'true');
  }

  function closeMobileMenu() {
    mobileMenu.classList.remove('active');
    mobileMenuOverlay.classList.remove('active');
    document.body.style.overflow = 'auto';
    mobileMenuToggle.setAttribute('aria-expanded', 'false');
  }

  if (mobileMenuToggle) {
    mobileMenuToggle.addEventListener('click', openMobileMenu);
  }

  if (mobileMenuClose) {
    mobileMenuClose.addEventListener('click', closeMobileMenu);
  }

  if (mobileMenuOverlay) {
    mobileMenuOverlay.addEventListener('click', closeMobileMenu);
  }

  // Close menu when a link is clicked
  mobileMenuLinks.forEach((link) => {
    link.addEventListener('click', closeMobileMenu);
  });

  // Close menu on Escape key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && mobileMenu.classList.contains('active')) {
      closeMobileMenu();
    }
  });

  // Sticky header on scroll
  const headerMain = document.querySelector('.header-main');
  let lastScrollTop = 0;

  window.addEventListener(
    'scroll',
    () => {
      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

      if (scrollTop > 50) {
        headerMain.classList.add('scrolled');
      } else {
        headerMain.classList.remove('scrolled');
      }

      lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;
    },
    false
  );

  // Search form submission
  const searchForms = document.querySelectorAll('.header-main__search-form');
  searchForms.forEach((form) => {
    form.addEventListener('submit', (e) => {
      const input = form.querySelector('input[name="q"]');
      if (!input.value.trim()) {
        e.preventDefault();
      }
    });
  });
{% endjavascript %}

<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Organization",
    "name": {{ shop.name | json }},
    {% if settings.logo %}
      "logo": {{ settings.logo | image_url: width: 500 | prepend: "https:" | json }},
    {% endif %}
    "sameAs": [
      {{ settings.social_twitter_link | json }},
      {{ settings.social_facebook_link | json }},
      {{ settings.social_pinterest_link | json }},
      {{ settings.social_instagram_link | json }},
      {{ settings.social_tiktok_link | json }},
      {{ settings.social_tumblr_link | json }},
      {{ settings.social_snapchat_link | json }},
      {{ settings.social_youtube_link | json }},
      {{ settings.social_vimeo_link | json }}
    ],
    "url": {{ request.origin | append: page.url | json }}
  }
</script>

{%- if request.page_type == 'index' -%}
  {% assign potential_action_target = request.origin | append: routes.search_url | append: '?q={search_term_string}' %}
  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "WebSite",
      "name": {{ shop.name | json }},
      "potentialAction": {
        "@type": "SearchAction",
        "target": {{ potential_action_target | json }},
        "query-input": "required name=search_term_string"
      },
      "url": {{ request.origin | append: page.url | json }}
    }
  </script>
{%- endif -%}

{% schema %}
{
  "name": "OBJYX - Header",
  "class": "section-header",
  "settings": [
    {
      "type": "link_list",
      "id": "menu",
      "default": "main-menu",
      "label": "Menu principal"
    }
  ],
  "blocks": [
    {
      "type": "@app"
    }
  ]
}
{% endschema %}
